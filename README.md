lowBase - низкоуровневая Yii2 CMS для программистов
===================================================

lowBase - низкоуровневая CMS (дословно: низкий уровень/основа), включающая в себя готовую универсальную
систему администрирования сайта и Yii2 основу для самостоятельной разработки клиентского приложения

[Демо панели администрирования](http://demo.lowbase.ru/admin "демо панели")  
[Сайт-источник](http://lowbase.ru "сайт-источник")  


Установка lowBase
-----------------

* `composer create-project lowbase/yii2-lowbase project-name dev-master`
* Создаем пустую базу данных и настраиваем соединение с базой в файле common/config/main.php
```
'db' => [
    'class' => 'yii\db\Connection',
    'dsn' => 'mysql:host=localhost;dbname=имя_базы_данных',
    'username' => 'пользватель',
    'password' => 'пароль',
    'charset' => 'utf8',
],
```
* Если хотите изменить данные администратора по умолчанию, то в console/migrations/130524_201442_init.php устанавливаем необходимые данные администратора сайта
```
    const OPTIONS_FIELD = 10;
    const ADMIN_FIRST_NAME = 'Иван';
    const ADMIN_LAST_NAME = 'Иванов';
    const ADMIN_EMAIL = 'admin@lowbase.ru';
    const ADMIN_PASSWORD = 'admin';
```
* Запускаем миграции коммандой `php yii migrate`
* Для работы EAUTH-авторизации необходимо зарегитсрировать приложение/сайт в соответствующих социальных сетях.
В файле common/config/eauth.php прописываем полученные ключи и id приложения:
```
'facebook' => array(
                // register your app here: https://developers.facebook.com/apps/
                'class' => 'nodge\eauth\services\FacebookOAuth2Service',
                'clientId' => 'сюда_вбиваем_id',
                'clientSecret' => 'сюда_вбиваем_секретный_ключи',
            ),
```

##Основы проектирования сайта на lowBase

Разработка сайта ведется по принципу "Программирование от содержимого". Т.е. создаем структуру на основе документов в панели администрирования, а затем переходим к Frontend-модулю, делая самостоятельно вывод и пользовательский ввод, используя готовые модели. Либо производим эти действия параллельно: программист или верстальщик занимается пользовательским интерфейсом, а контент-менеджеры заполняют содержимое документов.

####Документ - универсальная сущность. Основа всего содержания

Документ - это:
* новость
* статья
* отзыв
* категория
* товар
* заказ магазина
* характеристка товара
* список со способами оплаты или доставки магазина
* сам способ оплаты или доставки
* тег для новости или статьи
* фотогалерея (основная страница вывода)
* альбом фотогалереи
* меню сайта
* пункт меню сайта
* ...

Структура документов ведется:
* по связи родитель-потомок
* с помощью метода Nested Intervals

####Быстрые расширенные поля

Каждый документ помимо основных полей имеет 10 расширенных настраиваемых (количество может быть изменено перед установкой). Они находятся в самой таблице Document базы данных. Их тип, название и обязательность заполнения настраивается в шаблоне. Такие поля более удобны при использовании, по ним быстрее происходит фильтрация (отсутсвие Join). Их используем для основных атрибутов документа.
Например:
* Цена товара (число)
* Сумма заказа (число)
* Рейтинг отзыва (список или число) 
* Вариант ответа опроса (список)
* ...

Пример обращения: `$model->option_1`

####Дополнительные поля

Используются если количество атрибутов документа больше количества быстрых полей, либо эти атрибуты могут иметь множество значений. Хранятся в отдельной таблице. Примеры использования:

* характеристика товара (список)
* Шаг инструкции (текст)
* Фотография альбома (изображение)
* ...

Пример обращения: `$model->fields[2][value][1]`,
где:
    2 - id дополнительного поля,
    1 - id значения поля



####Сообщения

Являются упрощенной сущностью документа. Используются для:

* комментариев (к статье, товару)
* сообщений (личные переписки)

Реализовать этот функционал можно и с помощью документов, но т.к. подобные элементы имеют пользовательское происхождение и их количество, обычно, велико,  а структура проста, то решено выделить их в отдельную сущность.


Правила работы с Frontend
-------------------------

* Взаимодействие с документами при разработке пользовательской части должно происходить [методами Nested Intervals](https://github.com/lowbase/yii2-nested-intervals "Nested Intervals")  (для правильного ведения структуры дерева проекта)
```
$document->save(); - неправильно
$document->appendTo($parent_model)->save();  - правильно
```

* Чтобы прикрепить дополнительные поля к документу необходимо:
1) указать его шаблон: `$document->template_id`
2) инициализировать документ: `$document ->ititialization()`
 
* При сохранении новых значений дополнительных полей документа для ключа значений используем префикс: new_
```
$model->fields[$option_id]['value']['new_'.$key] = $new_value
```
все записи дополнительных полей сохраняются во внешней таблице автоматически после сохранения документа.

